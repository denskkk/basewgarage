<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        button:hover {
            background: #005a87;
        }
        .danger {
            background: #dc3545;
        }
        .danger:hover {
            background: #c82333;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –≤—ã—Ö–æ–¥–∞</h1>
        
        <h3>–°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:</h3>
        <div id="authStatus">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
        
        <h3>–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</h3>
        <div id="currentUser">–ó–∞–≥—Ä—É–∂–∞–µ–º...</div>
        
        <h3>–¢–µ—Å—Ç—ã:</h3>
        <button onclick="testLogout()">–¢–µ—Å—Ç –≤—ã—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Dashboard</button>
        <button onclick="testDirectLogout()">–ü—Ä—è–º–æ–π –≤—ã—Ö–æ–¥ —á–µ—Ä–µ–∑ UserManager</button>
        <button onclick="testClearData()">–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        <button onclick="checkElements()" class="danger">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</button>
        
        <h3>–õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π:</h3>
        <div class="log" id="logOutput"></div>
        
        <h3>–ù–∞–≤–∏–≥–∞—Ü–∏—è:</h3>
        <button onclick="window.location.href='login.html'">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞</button>
        <button onclick="window.location.href='dashboard.html'">–ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</button>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="js/auth.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/roleData.js"></script>
    <script src="js/profile-navigation.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/schedule.js"></script>
    <script src="js/dashboard.js"></script>

    <script>
        let logDiv = document.getElementById('logOutput');
        
        function log(message) {
            console.log(message);
            logDiv.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateStatus() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º UserManager
                if (window.UserManager) {
                    const isLoggedIn = window.UserManager.isLoggedIn();
                    const currentUser = window.UserManager.getCurrentUser();
                    
                    document.getElementById('authStatus').textContent = isLoggedIn ? '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' : '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
                    document.getElementById('currentUser').textContent = currentUser ? 
                        `${currentUser.name} (${currentUser.role})` : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω';
                    
                    log(`–°—Ç–∞—Ç—É—Å: ${isLoggedIn ? '–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' : '–Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'}`);
                    if (currentUser) {
                        log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${currentUser.name} (${currentUser.role})`);
                    }
                } else {
                    log('‚ùå UserManager –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞: ' + error.message);
            }
        }
        
        function testLogout() {
            log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç –≤—ã—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Dashboard...');
            try {
                if (window.dashboard && typeof window.dashboard.logout === 'function') {
                    log('‚úÖ Dashboard –Ω–∞–π–¥–µ–Ω, –≤—ã–∑—ã–≤–∞–µ–º logout()');
                    window.dashboard.logout();
                } else if (window.logout && typeof window.logout === 'function') {
                    log('‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è logout –Ω–∞–π–¥–µ–Ω–∞');
                    window.logout();
                } else {
                    log('‚ùå Dashboard –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è logout –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                }
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ —á–µ—Ä–µ–∑ Dashboard: ' + error.message);
            }
        }
        
        function testDirectLogout() {
            log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä—è–º–æ–π —Ç–µ—Å—Ç –≤—ã—Ö–æ–¥–∞...');
            try {
                if (window.UserManager && typeof window.UserManager.logout === 'function') {
                    log('‚úÖ UserManager –Ω–∞–π–¥–µ–Ω, –≤—ã–∑—ã–≤–∞–µ–º logout()');
                    const result = window.UserManager.logout();
                    log('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—Ö–æ–¥–∞: ' + result);
                    updateStatus();
                } else {
                    log('‚ùå UserManager –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è logout –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                }
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä—è–º–æ–º –≤—ã—Ö–æ–¥–µ: ' + error.message);
            }
        }
        
        function testClearData() {
            log('üîÑ –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
            try {
                localStorage.removeItem('wgarage-current-user');
                sessionStorage.removeItem('wgarage-current-user');
                log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã –∏–∑ localStorage –∏ sessionStorage');
                updateStatus();
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
            }
        }
        
        function checkElements() {
            log('üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–±—ä–µ–∫—Ç–æ–≤
            log('UserManager: ' + (window.UserManager ? '‚úÖ –¥–æ—Å—Ç—É–ø–µ–Ω' : '‚ùå –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω'));
            log('Dashboard: ' + (window.dashboard ? '‚úÖ –¥–æ—Å—Ç—É–ø–µ–Ω' : '‚ùå –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω'));
            log('NotificationManager: ' + (window.NotificationManager ? '‚úÖ –¥–æ—Å—Ç—É–ø–µ–Ω' : '‚ùå –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω'));
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
            const logoutLink = document.getElementById('logoutLink');
            log('logoutLink element: ' + (logoutLink ? '‚úÖ –Ω–∞–π–¥–µ–Ω' : '‚ùå –Ω–µ –Ω–∞–π–¥–µ–Ω'));
            
            if (logoutLink) {
                log('logoutLink —Ç–∏–ø: ' + logoutLink.tagName);
                log('logoutLink href: ' + logoutLink.href);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            log('üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            setTimeout(() => {
                updateStatus();
                checkElements();
            }, 1000);
        });
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        setInterval(updateStatus, 5000);
    </script>
</body>
</html>
